package centralApplication;

import java.io.IOException;
import java.io.InputStream;
import java.io.ObjectInputStream;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.ArrayList;

public class DataTransferServer {

	private ServerSocket mainDeviceServerSocket;
	private Socket ClientToServerSocket;

	/**
	 * @param mainDeviceServerSocket
	 * @param clientToServerSocket
	 * @throws IOException
	 */
	public DataTransferServer() throws IOException {
		this.ClientToServerSocket = mainDeviceServerSocket.accept(); 	// blocking call, this will wait until a connection
																		// is
																		// attempted on this port.

	}

	public void setupConnection() throws IOException {
		
		this.mainDeviceServerSocket = new ServerSocket(7778);  			//machine local donc pas d'adress
		
	}
	public void connect() {
		System.out.println("En attente");
		System.out.println("Connection en cours de la part de " + ClientToServerSocket + "...");

		InputStream inputStream = ClientToServerSocket.getInputStream(); 
		// create a DataInputStream so we can read data from it.
		ObjectInputStream objectInputStream = new ObjectInputStream(inputStream);

		// read the list of messages from the socket
		ArrayList<String> listOfUpdates = (ArrayList<String>) objectInputStream.readObject();
		System.out.println("Received [" + listOfUpdates.size() + "] messages from: " + ClientToServerSocket);
		// print out the text of every message
		System.out.println("All messages:");
		listOfUpdates.forEach((msg) -> System.out.println(msg));

		System.out.println("Closing sockets.");
		mainDeviceServerSocket.close();
		ClientToServerSocket.close();
	}

}
