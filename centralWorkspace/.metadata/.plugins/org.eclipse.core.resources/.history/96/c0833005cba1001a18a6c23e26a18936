package central;

import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.ArrayList;

import javax.swing.BoxLayout;
import javax.swing.JButton;
import javax.swing.JLabel;
import javax.swing.JList;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JSplitPane;
import javax.swing.JTable;
import javax.swing.JTextField;
import javax.swing.JViewport;
import javax.swing.ListSelectionModel;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;

public class WorkerView extends JPanel implements ListSelectionListener, ActionListener {

	private JTextField searchField;
	private JButton searchButton;
	private JButton addButton;
	
	private JPanel menuPane;
	private BoxLayout menuLayout;
	
	private JScrollPane workersListPane;
	private JScrollPane workerInfoPane;
	private JSplitPane splitPane;
	
	private int lastWorkerIndex = -1;

	private ArrayList<Integer> workerList = new ArrayList<Integer>();
	
	private JButton modifButton;
	private JButton delButton;
	
	private Company comp;
	
	public WorkerView(Company comp) {
		this.comp = comp;
		
		searchField = new JTextField();
		searchField.setColumns(10);
		
		searchButton = new JButton("search");
		searchButton.addActionListener(this);
		addButton = new JButton("add");
		addButton.addActionListener(this);
		
		menuLayout = new BoxLayout(menuPane, BoxLayout.X_AXIS);
		menuPane = new JPanel();
		
		menuPane.add(searchField);
		menuPane.add(searchButton);
		menuPane.add(addButton);
		
		workersListPane = new JScrollPane();
		workerInfoPane = new JScrollPane();
		
		splitPane = new JSplitPane(JSplitPane.HORIZONTAL_SPLIT, workersListPane, workerInfoPane);
		
		setData();
		
		this.setLayout(new BorderLayout());
		
		this.add(menuPane, BorderLayout.PAGE_START);
		this.add(splitPane, BorderLayout.CENTER);
		
	}
	
	public void setData() {

		ArrayList<Department> departArray = comp.getDepartment_List();

		for(Department depart : departArray) {
			
			ArrayList<Worker> workerArray = depart.getWorker_List();
			for(Worker worker : workerArray) {
				workerList.add(worker.getId_Worker());
			}

		}

		updateWList();
	}
	
	public void updateInfo(int workerId) {

		JPanel infoPane = new JPanel();
		infoPane.setLayout(new BorderLayout());
		
		JPanel infoList = new JPanel();
		BoxLayout infoBoxLayout = new BoxLayout(infoList, BoxLayout.Y_AXIS);
		infoList.setLayout(infoBoxLayout);
		
		Worker w = null;
		try {
			w = comp.whereIsWorker(workerId).getWorkerById(workerId);
		} catch (Exception e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		}

		infoList.add(new JLabel("Nom : " +w.getLastname_Worker()));
		infoList.add(new JLabel("Prenom : " +w.getFirstname_Worker()));
		infoList.add(new JLabel("Horaires par defaut : "));
		
		Object[][] defaultTimeList = new Object[2][5];
		
		for(int loopDays = 0; loopDays < 5; loopDays++) {
			defaultTimeList[0][loopDays] = w.getDefault_ArrivalTime_Worker_ByWeekDayCode(loopDays);
			defaultTimeList[1][loopDays] = w.getDefault_DepartureTime_Worker_ByWeekDayCode(loopDays);
		}
		
		String[] enteteDays = {"Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi"};
		
		JTable daysTab = new JTable(defaultTimeList, enteteDays);
		daysTab.getTableHeader().setResizingAllowed(false);
		daysTab.getTableHeader().setReorderingAllowed(false);
		
		JScrollPane daysPanel = new JScrollPane(daysTab);
		daysPanel.setPreferredSize(new Dimension(300, 55));
		
		infoList.add(daysPanel);
		
		infoList.add(new JLabel("Pointages :"));
		
		WorkingDaysTableView workedDaysTab = new WorkingDaysTableView(w);
		
		modifButton = new JButton("modification");
		modifButton.addActionListener(this);
		delButton = new JButton("delete");
		delButton.addActionListener(this);
		
		JPanel paramPane = new JPanel();
		BoxLayout paramLayout = new BoxLayout(paramPane, BoxLayout.X_AXIS);
		
		paramPane.add(modifButton);
		paramPane.add(delButton);

		infoPane.add(infoList, BorderLayout.PAGE_START);
		infoPane.add(workedDaysTab, BorderLayout.CENTER);
		infoPane.add(paramPane, BorderLayout.PAGE_END);
		
		workerInfoPane.setViewportView(infoPane);
	}
	
	public void updateWList() {
		ArrayList<String> nameList = new ArrayList<>();
		for(int id : workerList) {
			try {
				nameList.add(comp.whereIsWorker(id).getWorkerById(id).getFirstname_Worker());
			} catch (Exception e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
		
		JList dList = new JList(nameList.toArray());

		dList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
		dList.setLayoutOrientation(JList.VERTICAL);

		dList.getSelectionModel().addListSelectionListener(this);

		workersListPane.setViewportView(dList);
	}

	@Override
	public void valueChanged(ListSelectionEvent e) {
		int workerIndex = ((JList)(((JViewport)workersListPane.getComponents()[0]).getView())).getSelectedIndex();
		
		if(workerIndex != lastWorkerIndex) {
			updateInfo(workerList.get(workerIndex));
			lastWorkerIndex = workerIndex;
		}
		else {
			
		}
	}

	@Override
	public void actionPerformed(ActionEvent e) {
		System.out.println(e.getActionCommand());
	}
	
}
